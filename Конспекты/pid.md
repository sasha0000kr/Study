# P составляющая

Пропорциональная составляющая предоставляет собой разность текущего значения с датчика и установки.

```
P = setpoint - input
```

Данная разность называется ошибкой регулирования, то есть насколько далеко находится система от заданного значения. Получается чем больше ошибка, тем больше будет управляющий сигнал и тем быстрее система будет приводить управляемую величину к заданному значению. Коэффициент kP тут влияет роль усиления ошибки и настраивается вручную. Но в то же время, если система пришла к заданной величине, ошибка станет равной нулю, и управляющий сигнал тоже! Другими словами, п регулятор никогда не сможет привести к заданному значению, всегда будет некая ошибка. П составляющая является основной в ПИД регуляторе и так сказать тянет самую большую лямку, регулятор может неплохо работать только лишь на ней одной. P составляющая исправляет ошибку в текущий момент времени.

# I составляющая

Интегральная составляющая просто суммирует в саму себя ту же самую ошибку, разность текущего и заданного значения, умноженную на период дискретизации системы, то есть на время, прошедшее с предыдущего расчёта dt – фактически берёт интеграл от ошибки по времени.

```
I = I + (setpoint - input) * dt
```

В самом регуляторе это ещё умножается на коэффициент kI, которым настраивается резкость данной составляющей. В интегральной составляющей буквально копится ошибка, что позволяет регулятору с течением времени полностью её устранить, то есть привести систему ровно к заданному значению с максимальной точностью. I составляющая исправляет прошлые, накопившиеся ошибки.

# D составляющая

Дифференциальная составляющая представляет собой разность текущей и предыдущей ошибки, поделенную на время между измерениями, то есть на ту же dt, которая общий период регулятора. Иными словами – это производная от ошибки по времени.

## Изменение ошибки во времени

```
err = setpoint - input
D = (err - prevErr) / dt
dt = t1 - t2
prevErr = err
```

### Формула

```
F2-F1/t2-t1
```

Фактически D составляющая реагирует на изменение сигнала с датчика, и чем сильнее происходит это изменение, тем большее значение прибавляется к общей сумме. Иными словами, D позволяет компенсировать резкие изменения в системе и при правильной настройке предотвратить сильное перерегулирование и уменьшить раскачку. Коэффициент д позволяет настроить вес, или резкость данной компенсации, как и остальные коэффициенты регулируют свои составляющие. D составляющая в первую очередь нужна для быстрых систем, то есть для систем с резкими изменениями, такие как квадрокоптер или шпиндель станка под переменной нагрузкой. D составляющая исправляет возможные будущие ошибки, анализируя скорость.

## Особенности реализации

Если промежутки времени однородны, то dt можно опустить.

# Полная реализация

```lua
--pid--
p = 0
i = 0
d = 0

--Входные значения регулятора--
set_point = 0          --Заданное значение
input = sim.Read()    --Чтение значений с датчика

--Обработка времени работы--
start_time = sim.getTime()
get_time = sim.getTime()

function pin (p, i, d, start_time, get_time set_point, input)
    --Объявление переменных--
    local I = 0 
    local prev_err = 0

    --Вычисление времени работы--
    local dt = start_time - get_time

    --Реализация вычислений--
    P = (set_point - input) 
    I = I + (set_point - input) * dt

    err = set_point - input
    D = (err - prev_err) / dt
    prev_err = err

    return (P*p + I*i + D*d)
```
